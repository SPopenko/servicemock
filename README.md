servicemock
===========

#Getting Started

##Requirements
-----

To run mockservice you need JDK 6 or later and grails-2.3.5. Installation process described in
detail in official docs: <a href="http://grails.org/doc/latest/guide/gettingStarted.html#requirements" target="_blank">
grails </a>, <a href="http://docs.oracle.com/javase/7/docs/webnotes/install/windows/jdk-installation-windows.html"
target="_blank">JDK</a>

##Run locally
--------

###Database configuration

* Download and install MySQL 5.6 db-server (<a href="http://dev.mysql.com/doc/refman/5.1/en/windows-installation.html"
    target="_blank">official docs</a>);
* Create new database - 'm_service_db' and user - (name:'m_service_user' / password:'qwerty10'); This can be done in this way:
    - open mysql console and create a database:

        mysql> create database m_service_db;
        Query OK, 1 row affected (0.00 sec)

    - create new user:

        mysql> grant usage on *.* to m_service_user@localhost identified by 'qwerty10';*
        Query OK, 0 rows affected (0.00 sec)

    - grant all privileges on the m_service_db database to this user:

        mysql> grant all privileges on m_service_db.* to m_service_user@localhost ;
        Query OK, 0 rows affected (0.00 sec)

###Deploying and Running the mockservice

Go to the application directory and run this grails  command:

    grails local -Dserver.port=8099 run-app

After that you can view mockservice by pointing a web browser to http://localhost:8099.

##Deploy application to OpenShift web-hosting

Before we deploy the application to OpenShift, we'll have to do few setup tasks :

Sign up for an OpenShift Account. It is completely free and Red Hat gives every user three free Gears on which to run
your applications.

Install the <a href="https://www.openshift.com/get-started#cli" target="_blank">rhc client</a> tool on your machine.
rhc is installable as a ruby gem, so you need to have ruby 1.8.7 or above on your machine. To install rhc, just type:

    gem install rhc

To update rhc to the latest version, execute the following command:

    gem update rhc

For additional assistance setting up the rhc command-line tool, see the following page:
<a href="https://openshift.redhat.com/community/developers/rhc-client-tools-install" target="_blank">
rhc-client-tools-install
</a>

Setup your OpenShift account using rhc setup command. This command will help you create a namespace and upload your
ssh keys to OpenShift server.

After setup, we can create OpenShift application by running the following command:

    rhc create-app mockservice tomcat-7 mysql-5.6

This will create an application container for us, called a gear, and setup all of the required SELinux policies and
cgroup configuration. OpenShift will also setup a private git repository for us and clone the repository to the local
system. Finally, OpenShift will propagate the DNS to the outside world.
The application will be accessible at http://mockservice-domain-name.rhcloud.com/. Replace domain-name with your own
unique OpenShift domain name (also sometimes called a namespace).

As we will be deploying war file, so we have to delete the default source generated by OpenShift:

    $ git rm -rf src/ pom.xml
    $ git commit -am "deleted default source code"

Open application-path/grails-app/conf/Config.groovy, and change mock.serverURL to actual:

    environments {
        development {
            ...
        }
        production {
            grails.logging.jul.usebridge = false
            mock.serverURL = "http://mockservice-domain-name.rhcloud.com
            //Replace domain-name with your own unique OpenShift domain name
        }
    }

Now we have to package the grails application into a war file. Go to application directory and run this command:

    grails prod target/ROOT.war

Copy ROOT.war to your OpenShift mockservice application webapps folder.

At final we have to add some changes to server.xml to avoid problems with css styles. More about it problem
<a href="https://www.openshift.com/forums/openshift/missing-css-files-when-using-grails-war-modules" target="_blank">here
</a>

Open OpenShift mockservice/.openshift/config/server.xml and set unpackWars to true ( in the Host element ):

    <Host name="localhost"  appBase="webapps" unpackWARs="true" autoDeploy="true">

Now add the war to your git repository and push the changes:

    $ git add .
    $ git commit -am "Deploy mockservice"
    $ git push

After code is pushed and war is successfully deployed, we can view the application running at
http://mockservice-{domain-name}.rhcloud.com.

A functional demo of the resulting project is available for review
<a href="http://http://mockservice-servicemock.rhcloud.com">here</a>.
